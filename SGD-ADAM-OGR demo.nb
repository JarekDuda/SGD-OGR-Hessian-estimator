(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     59603,       1430]
NotebookOptionsPosition[     58922,       1409]
NotebookOutlinePosition[     59399,       1427]
CellTagsIndexPosition[     59356,       1424]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"article", ",", " ", 
    RowBox[{
     RowBox[{"sources", ":", " ", "https", ":"}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"github", ".", "com"}], "/", "JarekDuda"}], "/", "SGD"}], "-",
       "OGR", "-", "Hessian", "-", "estimator"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"popular", " ", 
     RowBox[{"overview", "/", 
      RowBox[{"benchmarks", ":", " ", "https", ":"}]}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{"www", ".", "ruder", ".", "io"}], "/", "optimizing"}], "-", 
     "gradient", "-", 
     RowBox[{"descent", "/"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"functions", " ", "from", " ", 
     RowBox[{"https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"en", ".", "wikipedia", ".", "org"}], "/", "wiki"}], "/", 
      "Test_functions"}], "_for", "_optimization"}]}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.886941185812662*^9, 3.886941246992798*^9}, {
  3.8869421449391565`*^9, 
  3.886942155557828*^9}},ExpressionUUID->"d26b43b1-6258-4aac-a226-\
e3f633118636"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"(*", 
       RowBox[{"traj", ",", "eval"}], "*)"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"SeedRandom", "[", "seed", "]"}], ";", 
      RowBox[{"rrn", "=", 
       RowBox[{"Round", "[", "rn", "]"}]}], ";", 
      RowBox[{"f", "=", 
       RowBox[{"fun", "[", 
        RowBox[{"[", "fn", "]"}], "]"}]}], ";", 
      RowBox[{"g", "=", 
       RowBox[{"gr", "[", 
        RowBox[{"[", "fn", "]"}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ix", ",", "iy"}], "}"}], "=", "pt"}], ";", 
      RowBox[{"\[Alpha]m", "=", 
       RowBox[{
        RowBox[{"Exp", "[", "l\[Alpha]m", "]"}], "+", "0."}]}], ";", 
      RowBox[{"hst", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Switch", "[", 
       RowBox[{"mode", ",", "                                    ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"3", " ", "modes", " ", "of", " ", 
           RowBox[{"work", ":", " ", "DensityPlot"}]}], ",", " ", "Plot3D", 
          ",", " ", 
          RowBox[{"evaluation", " ", "on", " ", "lattice"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", "1", ",", 
        RowBox[{
         RowBox[{"traj", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"fndtr", "[", 
             RowBox[{"ix", ",", "iy", ",", "mt"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"mt", ",", "mtn"}], "}"}]}], "]"}]}], ";", 
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"ContourPlot", "[", 
            RowBox[{
             RowBox[{"Log", "[", "f", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", 
               RowBox[{"-", "rn"}], ",", "rn"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", 
               RowBox[{"-", "rn"}], ",", "rn"}], "}"}], ",", 
             RowBox[{"ImageSize", "->", "500"}], ",", 
             RowBox[{"PlotLabel", "->", 
              RowBox[{"Row", "[", 
               RowBox[{"{", 
                RowBox[{"steps", ",", " ", 
                 RowBox[{"Style", "[", 
                  RowBox[{"\"\< steps\>\"", ",", "Bold"}], "]"}], ",", 
                 "\"\< for methods: \>\"", ",", 
                 RowBox[{"Row", "[", 
                  RowBox[{"labn", ",", "\"\<,\>\""}], "]"}]}], "}"}], 
               "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Text", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<x\>\"", ",", "Red"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}], ",", "Orange", ",", 
              RowBox[{"Ball", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ix", ",", "iy"}], "}"}], ",", "0.1"}], "]"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
                  RowBox[{"col", "[", 
                   RowBox[{"[", "mt", "]"}], "]"}], ",", 
                  RowBox[{"Line", "[", 
                   RowBox[{"traj", "[", 
                    RowBox[{"[", "mt", "]"}], "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"mt", ",", "mtn"}], "}"}]}], "]"}]}], "}"}], "]"}]}],
           "]"}]}], ",", "\[IndentingNewLine]", "2", ",", 
        RowBox[{
         RowBox[{"traj", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"tr", "=", 
              RowBox[{"fndtr", "[", 
               RowBox[{"ix", ",", "iy", ",", "mt"}], "]"}]}], ";", 
             RowBox[{"Transpose", "[", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", "tr", "]"}], ",", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"f", "/.", 
                   RowBox[{"sub", "[", "t", "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"t", ",", "tr"}], "}"}]}], "]"}]}], "]"}], "]"}]}],
             ",", 
            RowBox[{"{", 
             RowBox[{"mt", ",", "mtn"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"Plot3D", "[", 
            RowBox[{"f", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", 
               RowBox[{"-", "rn"}], ",", "rn"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"y", ",", 
               RowBox[{"-", "rn"}], ",", "rn"}], "}"}], ",", 
             RowBox[{"ImageSize", "->", "500"}], ",", 
             RowBox[{"PlotLabel", "->", 
              RowBox[{"Row", "[", 
               RowBox[{"{", 
                RowBox[{
                "steps", ",", " ", "\"\< steps for methods: \>\"", ",", 
                 RowBox[{"Grid", "[", 
                  RowBox[{"{", "labn", "}"}], "]"}]}], "}"}], "]"}]}]}], 
            "]"}], ",", 
           RowBox[{"Graphics3D", "[", 
            RowBox[{"{", 
             RowBox[{"Thick", ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", 
                   RowBox[{"10", "^", "6"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}], "]"}], 
              ",", "Orange", ",", 
              RowBox[{"Ball", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ix", ",", "iy", ",", 
                  RowBox[{"f", "/.", 
                   RowBox[{"sub", "[", 
                    RowBox[{"{", 
                    RowBox[{"ix", ",", "iy"}], "}"}], "]"}]}]}], "}"}], ",", 
                "0.1"}], "]"}], ",", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Thickness", "[", "0.01", "]"}], ",", 
                  RowBox[{"col", "[", 
                   RowBox[{"[", "mt", "]"}], "]"}], ",", 
                  RowBox[{"Line", "[", 
                   RowBox[{"traj", "[", 
                    RowBox[{"[", "mt", "]"}], "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"mt", ",", "mtn"}], "}"}]}], "]"}]}], "}"}], "]"}]}],
           "]"}]}], ",", "\[IndentingNewLine]", "3", ",", 
        RowBox[{
         RowBox[{"eval", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sort", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"fndtr", "[", 
                  RowBox[{"ix", ",", "iy", ",", "mt"}], "]"}], ";", 
                 RowBox[{"f", "/.", 
                  RowBox[{"sub", "[", "\[Theta]", "]"}]}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"ix", ",", 
                  RowBox[{"-", "rn"}], ",", "rn", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"iy", ",", 
                  RowBox[{"-", "rn"}], ",", "rn", ",", "1"}], "}"}]}], "]"}], 
              "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"mt", ",", "mtn"}], "}"}]}], "]"}]}], ";", 
         RowBox[{"geo", "=", 
          RowBox[{"Exp", "[", 
           RowBox[{"Map", "[", 
            RowBox[{"Mean", ",", 
             RowBox[{"Log", "[", "eval", "]"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Show", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ListLogPlot", "[", 
             RowBox[{"eval", ",", 
              RowBox[{"PlotStyle", "->", "col"}], ",", 
              RowBox[{"PlotLabels", "->", "labn"}], ",", 
              RowBox[{"ImageSize", "->", "500"}], ",", 
              RowBox[{"PlotLabel", "->", 
               RowBox[{"Column", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{"\"\<Sorted values from \>\"", ",", 
                    RowBox[{
                    RowBox[{"2", "rrn"}], "+", "1"}], ",", "\"\<x\>\"", ",", 
                    RowBox[{
                    RowBox[{"2", "rrn"}], "+", "1"}], ",", 
                    "\"\< lattice after \>\"", ",", "steps", ",", 
                    "\"\< steps\>\""}], "}"}], "]"}], ",", " ", 
                   "\"\<Their geometric means (plotted thin lines):\>\"", ",", 
                   RowBox[{"Grid", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"labn", ",", "geo"}], "}"}], ",", 
                    RowBox[{"Frame", "->", "All"}]}], "]"}]}], "}"}], ",", 
                 "Center"}], "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"ListLogPlot", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", 
                    RowBox[{"geo", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"eval", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"geo", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "mtn"}], "}"}]}], "]"}], ",", 
              RowBox[{"Joined", "->", "True"}], ",", 
              RowBox[{"PlotStyle", "->", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Thin", ",", "c"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"c", ",", "col"}], "}"}]}], "]"}]}]}], "]"}]}], 
           "}"}], "]"}]}]}], "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"mode", ",", "1", ",", "\"\<mode:\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"1", "->", "\"\<2D\>\""}], ",", 
       RowBox[{"2", "->", "\"\<3D\>\""}], ",", 
       RowBox[{"3", "->", "\"\<eval\>\""}]}], "}"}]}], "}"}], ",", " ", 
   RowBox[{"(*", " ", 
    RowBox[{"mode", " ", "of", " ", "work"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pt", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", "\"\<start:\>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "3"}], ",", 
       RowBox[{"-", "3"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"3", ",", "3"}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"steps", ",", "20", ",", "\"\<steps\>\""}], "}"}], ",", "1", 
     ",", "50", ",", "1", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "  ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"number", " ", "of", " ", "steps"}], " ", "-", " ", 
     RowBox[{"basic", " ", "to", " ", "animate"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"fname", "[", 
        RowBox[{"[", "fn", "]"}], "]"}], ",", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\< function\>\"", ",", "Bold"}], "]"}], ",", 
       "\"\< in [\>\"", ",", 
       RowBox[{"-", "rn"}], ",", "\"\<,\>\"", ",", "rn", ",", 
       "\"\<\!\(\*SuperscriptBox[\(]\), \(2\)]\) range\>\""}], "}"}], "]"}], 
    "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"fn", ",", "1", ",", "\"\<func\>\""}], "}"}], ",", 
     RowBox[{"Range", "[", "5", "]"}]}], "}"}], ",", "        ", 
   RowBox[{"(*", " ", 
    RowBox[{"function", " ", "choice"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rn", ",", "3", ",", "\"\<range\>\""}], "}"}], ",", "1", ",", 
     "10", ",", "0.1", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "         ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"plot", " ", "range"}], ",", " ", 
     RowBox[{
     "also", " ", "used", " ", "in", " ", "evaluation", " ", "for", " ", 
      "lattice"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<N(0,\>\"", ",", "\[Sigma]", ",", "\"\<) \>\"", ",", 
       RowBox[{"Style", "[", 
        RowBox[{"\"\<noise\>\"", ",", "Bold"}], "]"}], ",", 
       "\"\< for seed = \>\"", ",", "seed"}], " ", "}"}], "]"}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Sigma]", ",", "0.5", ",", "\"\<noise\>\""}], "}"}], ",", 
     "0.0001", ",", "10", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "  ", 
   RowBox[{"(*", " ", 
    RowBox[{"added", " ", "N", 
     RowBox[{"(", 
      RowBox[{"0", ",", "\[Sigma]"}], ")"}], " ", "Gaussian", " ", "random", 
     " ", "noise", " ", "to", " ", "gradients"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"seed", ",", "1", ",", "\"\<seed\>\""}], "}"}], ",", "1", ",", 
     "100", ",", "1", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "      ", 
   RowBox[{"(*", " ", 
    RowBox[{"seed", " ", "for", " ", "random", " ", "noise"}], " ", "*)"}], 
   "\[IndentingNewLine]", "Delimiter", ",", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Style", "[", 
        RowBox[{"\"\<Hyperparameters\>\"", ",", "Bold"}], "]"}], ",", 
       "\"\<, SGD: \[Alpha]m = \>\"", ",", "\[Alpha]m"}], "}"}], "]"}], "]"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"l\[Alpha]m", ",", 
       RowBox[{"-", "9"}], ",", "\"\<ln(\[Alpha]m)\>\""}], "}"}], ",", 
     RowBox[{"-", "12"}], ",", 
     RowBox[{"-", "6"}], ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "tiny", " ", "fixed", " ", "learning", " ", "rate", " ", "for", " ", 
     "vanilla", " ", "SGD", " ", "and", " ", "momentum"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<momentum: \[Alpha]m = \>\"", ",", "\[Alpha]m", ",", " ", 
       "\"\<, \[Beta]1 = \>\"", ",", "\[Beta]1"}], "}"}], "]"}], "]"}], ",", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<ADAM: \[Alpha] = \>\"", ",", "\[Alpha]", ",", 
       "\"\<, \[Beta]1 = \>\"", ",", "\[Beta]1", ",", " ", 
       "\"\<, \[Beta]2 = \>\"", ",", "\[Beta]2"}], "}"}], "]"}], "]"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Alpha]", ",", "0.5", ",", "\"\<\[Alpha]\>\""}], "}"}], ",", 
     "0", ",", "1", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "             ", 
   RowBox[{"(*", " ", 
    RowBox[{"larger", " ", "learning", " ", "late", " ", "for", " ", "ADAM"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Beta]1", ",", "0.8", ",", "\"\<\[Beta]1\>\""}], "}"}], ",", 
     "0", ",", "1", ",", "0.01", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "           ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "first", " ", "adaptation", " ", "rate", " ", "for", " ", "ADAM"}], ",", 
     " ", 
     RowBox[{"also", " ", "momentum"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Beta]2", ",", "0.9", ",", "\"\<\[Beta]2\>\""}], "}"}], ",", 
     "0", ",", "1", ",", "0.01", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "           ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "second", " ", "adaptation", " ", "rate", " ", "for", " ", "ADAM"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Dynamic", "[", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<OGR: \[Eta] = \>\"", ",", "\[Eta]", ",", " ", 
       "\"\<, \[Beta] = \>\"", ",", "\[Beta]", ",", "\"\<, \[Gamma] = \>\"", 
       ",", "\[Gamma]"}], "}"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Eta]", ",", "0.7", ",", "\"\<\[Eta]\>\""}], "}"}], ",", "0", 
     ",", "1", ",", "0.01", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "          ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"OGR", " ", "step", " ", "size"}], ",", " ", 
     StyleBox[
      RowBox[{"\[Eta]", "=", 
       RowBox[{
       "1", " ", "is", " ", "full", " ", "trust", " ", "in", " ", "2", "nd", 
        " ", "order", " ", "method"}]}],
      FontSize->14]}], 
    StyleBox[" ",
     FontSize->14], "*)"}], " ", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Beta]", ",", "0.7", ",", "\"\<\[Beta]\>\""}], "}"}], ",", 
     "0", ",", "1", ",", "0.01", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "          ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "OGR", " ", "adaptation", " ", "rate", " ", "for", " ", "Hessian", " ", 
     "estimation"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\[Gamma]", ",", "0.7", ",", "\"\<\[Gamma]\>\""}], "}"}], ",", 
     "0", ",", "1", ",", "0.01", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", "          ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "OGR", " ", "adaptation", " ", "rate", " ", "for", " ", "momentum", " ", 
     "in", " ", "Newton", " ", "method"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"max\[Alpha]", ",", "0.1", ",", "\"\<max\[Alpha]\>\""}], "}"}], 
     ",", "0.01", ",", "1", ",", 
     RowBox[{"ImageSize", "->", "Small"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Initialization", "\[RuleDelayed]", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Epsilon]", "=", 
       RowBox[{"10", "^", 
        RowBox[{"-", "6"}]}]}], ";", "                                     ", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "hidden", " ", "hyperparameter", " ", "avoiding", " ", "very", " ", 
         "large", " ", "steps"}], ",", " ", 
        RowBox[{"also", " ", "used", " ", "in", " ", "initialization"}]}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"methods", "=", 
       RowBox[{"{", 
        RowBox[{
        "\"\<SGD\>\"", ",", "\"\<momentum\>\"", ",", "\"\<ADAM\>\"", ",", 
         "\"\<cdOGR\>\"", ",", "\"\<cfOGR\>\""}], "}"}]}], ";", 
      RowBox[{"col", "=", 
       RowBox[{"{", 
        RowBox[{
        "Black", ",", "Gray", ",", "Brown", ",", "Green", ",", "Blue", ",", 
         "Cyan"}], "}"}]}], ";", 
      RowBox[{"mtn", "=", 
       RowBox[{"Length", "[", "methods", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"labn", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"methods", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"col", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "mtn"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fname", "=", 
       RowBox[{"{", 
        RowBox[{
        "\"\<Beale\>\"", ",", "\"\<Rosenbrock\>\"", ",", "\"\<Matyas\>\"", 
         ",", "\"\<Goldstein-Price\>\"", ",", "\"\<Three-hump camel\>\""}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fun", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1.5", "-", "x", "+", 
               RowBox[{"x", "*", "y"}]}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"2.25", "-", "x", "+", 
               RowBox[{"x", "*", 
                SuperscriptBox["y", "2"]}]}], ")"}], "2"], "+", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"2.625", "-", "x", "+", 
               RowBox[{"x", "*", 
                SuperscriptBox["y", "3"]}]}], ")"}], "2"]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "->", 
              RowBox[{"x", "+", "3"}]}], ",", 
             RowBox[{"y", "->", 
              RowBox[{"y", "+", "0.5"}]}]}], "}"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "x"}], ")"}], "2"], "+", 
            RowBox[{"100", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"y", "-", 
                SuperscriptBox["x", "2"]}], ")"}], "2"]}]}], "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"x", "->", 
              RowBox[{"x", "+", "1"}]}], ",", 
             RowBox[{"y", "->", 
              RowBox[{"y", "+", "1"}]}]}], "}"}]}], ",", 
          RowBox[{
           RowBox[{"0.26", 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["x", "2"], "+", 
              SuperscriptBox["y", "2"]}], ")"}]}], "-", 
           RowBox[{"0.48", "x", "*", "y"}]}], ",", "    ", 
          RowBox[{"(*", " ", 
           RowBox[{"minima", " ", "shifted", " ", "to", " ", 
            RowBox[{"(", 
             RowBox[{"0", ",", "0"}], ")"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"x", "+", "y", "+", "1"}], ")"}], "2"], 
                RowBox[{"(", 
                 RowBox[{"19", "-", 
                  RowBox[{"14", "x"}], "+", 
                  RowBox[{"3", 
                   SuperscriptBox["x", "2"]}], "-", 
                  RowBox[{"14", "y"}], "+", 
                  RowBox[{"6", "x", "*", "y"}], "+", 
                  RowBox[{"3", 
                   SuperscriptBox["y", "2"]}]}], ")"}]}]}], ")"}], 
             RowBox[{"(", 
              RowBox[{"30", "+", 
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"2", "x"}], "-", 
                   RowBox[{"3", "y"}]}], ")"}], "2"], 
                RowBox[{"(", 
                 RowBox[{"18", "-", 
                  RowBox[{"32", "x"}], "+", 
                  RowBox[{"12", 
                   SuperscriptBox["x", "2"]}], "+", 
                  RowBox[{"48", "y"}], "-", 
                  RowBox[{"36", "x", "*", "y"}], "+", 
                  RowBox[{"27", 
                   SuperscriptBox["y", "2"]}]}], ")"}]}]}], ")"}]}], "-", 
            "3"}], "/.", 
           RowBox[{"y", "->", 
            RowBox[{"y", "-", "1"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"2", 
            SuperscriptBox["x", "2"]}], "-", 
           RowBox[{"1.05", 
            SuperscriptBox["x", "4"]}], "+", 
           RowBox[{
            SuperscriptBox["x", "6"], "/", "6"}], "+", 
           RowBox[{"x", "*", "y"}], "+", 
           SuperscriptBox["y", "2"]}]}], "}"}], "//", "Simplify"}]}], ";", 
      "    ", 
      RowBox[{"(*", "  ", 
       RowBox[{
        RowBox[{"https", ":"}], "//", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"en", ".", "wikipedia", ".", "org"}], "/", "wiki"}], "/", 
          "Test_functions"}], "_for", "_optimization"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"gr", "=", 
       RowBox[{"Simplify", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Grad", "[", 
           RowBox[{"f", ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "y"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"f", ",", "fun"}], "}"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"nbf", "=", 
       RowBox[{"Length", "[", "fun", "]"}]}], ";", 
      RowBox[{"v", "=", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], ";", 
      RowBox[{"d", "=", 
       RowBox[{"Length", "[", "v", "]"}]}], ";", 
      RowBox[{
       RowBox[{"s", "[", "M_", "]"}], ":=", 
       RowBox[{"M", "+", 
        RowBox[{"Transpose", "[", "M", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sub", "[", "p_", "]"}], ":=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"v", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "->", 
          RowBox[{"p", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "d"}], "}"}]}], "]"}]}], ";", " ", 
      RowBox[{"maxd", "=", "20"}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"maxd", " ", "-", " ", 
        RowBox[{
        "imprison", " ", "in", " ", "sphere", " ", "of", " ", "mard", " ", 
         "radius", " ", "to", " ", "avoid", " ", "infinity"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"noise", ":=", 
       RowBox[{"RandomReal", "[", 
        RowBox[{
         RowBox[{"NormalDistribution", "[", 
          RowBox[{"0", ",", "\[Sigma]"}], "]"}], ",", "d"}], "]"}]}], ";", 
      "         ", 
      RowBox[{"(*", " ", 
       RowBox[{
       "add", " ", "noise", " ", "to", " ", "calculated", " ", "gradients"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fndtr", "[", 
        RowBox[{"ix_", ",", "iy_", ",", "mt_"}], "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Theta]", "=", 
          RowBox[{"{", 
           RowBox[{"ix", ",", "iy"}], "}"}]}], ";", 
         RowBox[{"t", "=", 
          RowBox[{"m", "=", 
           RowBox[{"mg", "=", 
            RowBox[{"m\[Theta]", "=", 
             RowBox[{"vv", "=", 
              RowBox[{"mg\[Theta]", "=", "0."}]}]}]}]}]}], ";", 
         RowBox[{"dgg", "=", 
          RowBox[{"d\[Theta]\[Theta]", "=", "\[Epsilon]"}]}], ";", 
         RowBox[{"m\[Theta]\[Theta]", "=", 
          RowBox[{"mgg", "=", 
           RowBox[{"\[Epsilon]", "*", 
            RowBox[{"IdentityMatrix", "[", "d", "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Prepend", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"p\[Theta]", "=", "\[Theta]"}], ";", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                 "SGD", ",", "momentum", ",", "ADAM", ",", "cdOGR", ",", 
                  "cfOGR"}], "}"}], "[", 
                RowBox[{"[", "mt", "]"}], "]"}], "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"g", "/.", 
                  RowBox[{"sub", "[", "\[Theta]", "]"}]}], ")"}], "+", 
                "noise"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Norm", "[", "\[Theta]", "]"}], ">", "maxd"}], ",", 
                RowBox[{"\[Theta]", "=", "p\[Theta]"}]}], "]"}], ";", 
              "\[Theta]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "steps"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"ix", ",", "iy"}], "}"}]}], "]"}]}], ")"}]}], ";", 
      "         ", 
      RowBox[{"(*", " ", 
       RowBox[{"proper", " ", "optimization"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"single", " ", "step", " ", "of", " ", "methods"}], ",", " ", 
        RowBox[{
         RowBox[{"OGR", ":", " ", "https", ":"}], "//", 
         RowBox[{
          RowBox[{
           RowBox[{"arxiv", ".", "org"}], "/", "pdf"}], "/", 
          "1901.11457"}]}]}], "  ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"SGD", "[", "ng_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{"\[Theta]", "-=", 
         RowBox[{"\[Alpha]m", "*", "ng"}]}], ")"}]}], ";", 
      "                                       ", 
      RowBox[{"(*", " ", 
       RowBox[{"step", " ", "of", " ", "vanilla", " ", "SGD"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"momentum", "[", "ng_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "+=", 
          RowBox[{"\[Beta]1", 
           RowBox[{"(", 
            RowBox[{"ng", "-", "m"}], ")"}]}]}], ";", 
         RowBox[{"\[Theta]", "-=", 
          RowBox[{"\[Alpha]m", "*", "ng"}]}]}], ")"}]}], ";", "         ", 
      RowBox[{"(*", " ", 
       RowBox[{"step", " ", "of", " ", "momentum", " ", "method"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ADAM", "[", "ng_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"t", "++"}], ";", 
         RowBox[{"m", "=", 
          RowBox[{
           RowBox[{"\[Beta]1", "*", "m"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "\[Beta]1"}], ")"}], "ng"}]}]}], ";", 
         RowBox[{"vv", "=", 
          RowBox[{
           RowBox[{"\[Beta]2", "*", "vv"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", "\[Beta]2"}], ")"}], 
            SuperscriptBox["ng", "2"]}]}]}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"ADAM", ":", " ", "https", ":"}], "//", 
           RowBox[{
            RowBox[{
             RowBox[{"arxiv", ".", "org"}], "/", "pdf"}], "/", 
            "1412.6980"}]}], "  ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\[Theta]", "-=", 
          RowBox[{"\[Alpha]", "*", 
           RowBox[{"m", "/", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Epsilon]", "+", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"vv", "/", 
                  RowBox[{"(", 
                   RowBox[{"1", "-", 
                    SuperscriptBox["\[Beta]2", "t"]}], ")"}]}], "]"}]}], 
               ")"}], "*", 
              RowBox[{"(", 
               RowBox[{"1", "-", 
                SuperscriptBox["\[Beta]1", "t"]}], ")"}]}], ")"}]}]}]}]}], 
        ")"}]}], ";", "                 ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cdOGR", "[", "ng_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m\[Theta]", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{"\[Theta]", "-", "m\[Theta]"}], ")"}]}]}], ";", 
         RowBox[{"mg", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{"ng", "-", "mg"}], ")"}]}]}], ";", 
         RowBox[{"m", "+=", 
          RowBox[{"\[Gamma]", 
           RowBox[{"(", 
            RowBox[{"ng", "-", "m"}], ")"}]}]}], ";", "       ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"diagonal", " ", "OGR"}], " ", "-", " ", 
           RowBox[{"separate", " ", "parabolas"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"d\[Theta]\[Theta]", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"\[Theta]", "-", "m\[Theta]"}], ")"}], "2"], "-", 
             "d\[Theta]\[Theta]"}], ")"}]}]}], ";", 
         RowBox[{"dgg", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{"ng", "-", "mg"}], ")"}], "2"], "-", "dgg"}], 
            ")"}]}]}], ";", "                           ", 
         RowBox[{"(*", " ", 
          RowBox[{"update", " ", "averages"}], " ", "*)"}], " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Theta]", "-=", 
          RowBox[{"\[Eta]", "*", "m", "*", 
           RowBox[{"Sqrt", "[", 
            RowBox[{"d\[Theta]\[Theta]", "/", 
             RowBox[{"(", 
              RowBox[{"dgg", "+", "\[Epsilon]"}], ")"}]}], "]"}]}]}]}], 
        ")"}]}], ";", 
      "                                                      ", 
      RowBox[{"(*", " ", 
       RowBox[{"Newton", " ", "step"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cfOGR", "[", "ng_", "]"}], ":=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "+=", 
          RowBox[{"\[Gamma]", 
           RowBox[{"(", 
            RowBox[{"ng", "-", "m"}], ")"}]}]}], ";", 
         "                                                                    \
               ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"full", " ", "OGR"}], " ", "-", " ", 
           RowBox[{"full", " ", "Hessian"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"m\[Theta]", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{"\[Theta]", "-", "m\[Theta]"}], ")"}]}]}], ";", 
         RowBox[{"m\[Theta]\[Theta]", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"KroneckerProduct", "[", 
              RowBox[{
               RowBox[{"\[Theta]", "-", "m\[Theta]"}], ",", 
               RowBox[{"\[Theta]", "-", "m\[Theta]"}]}], "]"}], "-", 
             "m\[Theta]\[Theta]"}], ")"}]}]}], ";", "   ", 
         RowBox[{"(*", " ", 
          RowBox[{"update", " ", "averages"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"mg", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{"ng", "-", "mg"}], ")"}]}]}], ";", 
         RowBox[{"mgg", "+=", 
          RowBox[{"\[Beta]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"KroneckerProduct", "[", 
              RowBox[{
               RowBox[{"ng", "-", "mg"}], ",", 
               RowBox[{"ng", "-", "mg"}]}], "]"}], "-", "mgg"}], ")"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[Sigma]\[Theta]", "=", 
          RowBox[{"MatrixFunction", "[", 
           RowBox[{"Sqrt", ",", "m\[Theta]\[Theta]"}], "]"}]}], ";", 
         RowBox[{"\[Sigma]g", "=", 
          RowBox[{"MatrixFunction", "[", 
           RowBox[{"Sqrt", ",", "mgg"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"e", ",", "ev"}], "}"}], "=", 
          RowBox[{"Eigensystem", "[", "m\[Theta]\[Theta]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"pH", "=", 
          RowBox[{
           RowBox[{"Transpose", "[", "ev", "]"}], ".", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"ev", ".", 
               RowBox[{"s", "[", 
                RowBox[{"\[Sigma]\[Theta]", ".", "\[Sigma]g"}], "]"}], ".", 
               RowBox[{"Transpose", "[", "ev", "]"}]}], ")"}], "/", 
             RowBox[{"s", "[", 
              RowBox[{"Table", "[", 
               RowBox[{"e", ",", "d"}], "]"}], "]"}]}], ")"}], ".", "ev"}]}], 
         ";", "     ", 
         RowBox[{"(*", " ", 
          RowBox[{"Hessian", " ", "estimator"}], " ", "*)"}], " ", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Theta]", "-=", 
          RowBox[{"\[Eta]", "*", 
           RowBox[{
            RowBox[{"MatrixFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{"1", "/", "#"}], ",", "max\[Alpha]"}], "]"}], "&"}], 
              ",", "pH"}], "]"}], ".", "m"}]}]}]}], ")"}]}], ";"}], 
     "                        ", 
     RowBox[{"(*", " ", 
      RowBox[{"Newton", ",", " ", 
       RowBox[{
        RowBox[{"1", "/"}], "|", 
        RowBox[{
         RowBox[{"~", "eigenvalues"}], " ", "of", " ", 
         RowBox[{"pH", ":", " ", 
          RowBox[{
           RowBox[{"predicted", " ", "Hessian"}], "|"}]}]}]}]}], " ", "*)"}], 
     ")"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"TrackedSymbols", "\[RuleDelayed]", 
    RowBox[{"{", 
     RowBox[{
     "steps", ",", "\[Sigma]", ",", "seed", ",", "fn", ",", "mode", ",", "rn",
       ",", "\[Alpha]", ",", "l\[Alpha]m", ",", "\[Beta]1", ",", "\[Beta]2", 
      ",", "\[Eta]", ",", "\[Beta]", ",", "\[Gamma]", ",", "pt", ",", 
      "max\[Alpha]"}], "}"}]}], ",", 
   RowBox[{"ControlPlacement", "->", "Left"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.887189833962146*^9, {3.887189891366813*^9, 3.887189891457813*^9}, {
   3.8871900788951254`*^9, 3.887190098012824*^9}, {3.8871901631559734`*^9, 
   3.887190184991439*^9}, {3.887196100355641*^9, 3.887196104007987*^9}, {
   3.887208061906768*^9, 3.8872080672760086`*^9}, {3.887252163412902*^9, 
   3.8872522081314263`*^9}, {3.8872522769646606`*^9, 3.887252427007126*^9}, {
   3.8872645055656023`*^9, 3.8872645307271357`*^9}, {3.8872646035525064`*^9, 
   3.887264608861339*^9}, {3.887264808813115*^9, 3.8872648224019685`*^9}},
 CellLabel->"In[114]:=",
 CellID->237946211,ExpressionUUID->"9995ae96-4f48-40b5-aeca-d4b381962e76"],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`fn$$ = 
    4, $CellContext`l\[Alpha]m$$ = -9, $CellContext`max\[Alpha]$$ = 
    0.1, $CellContext`mode$$ = 1, $CellContext`pt$$ = {
    2.12, -2.95}, $CellContext`rn$$ = 3, $CellContext`seed$$ = 
    1, $CellContext`steps$$ = 20, $CellContext`\[Alpha]$$ = 
    0.5, $CellContext`\[Beta]$$ = 0.7, $CellContext`\[Beta]1$$ = 
    0.8, $CellContext`\[Beta]2$$ = 0.9, $CellContext`\[Gamma]$$ = 
    0.7, $CellContext`\[Eta]$$ = 0.7, $CellContext`\[Sigma]$$ = 0.5, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`mode$$], 1, "mode:"}, {
      1 -> "2D", 2 -> "3D", 3 -> "eval"}}, {{
       Hold[$CellContext`pt$$], {1, 2}, "start:"}, {-3, -3}, {3, 3}}, {{
       Hold[$CellContext`steps$$], 20, "steps"}, 1, 50, 1}, {
      Hold[
       Dynamic[
        Row[{
          Part[$CellContext`fname, $CellContext`fn$$], 
          Style[" function", Bold], " in [", -$CellContext`rn$$, 
          ",", $CellContext`rn$$, 
          "\!\(\*SuperscriptBox[\(]\), \(2\)]\) range"}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`fn$$], 1, "func"}, {1, 2, 3, 4, 5}}, {{
       Hold[$CellContext`rn$$], 3, "range"}, 1, 10, 0.1}, {
      Hold[
       Dynamic[
        Row[{"N(0,", $CellContext`\[Sigma]$$, ") ", 
          Style["noise", Bold], " for seed = ", $CellContext`seed$$}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`\[Sigma]$$], 0.5, "noise"}, 0.0001, 10}, {{
       Hold[$CellContext`seed$$], 1, "seed"}, 1, 100, 1}, {
      Hold[
       Dynamic[
        Row[{
          Style["Hyperparameters", Bold], 
          ", SGD: \[Alpha]m = ", $CellContext`\[Alpha]m}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`l\[Alpha]m$$], -9, "ln(\[Alpha]m)"}, -12, -6}, {
      Hold[
       Dynamic[
        Row[{
         "momentum: \[Alpha]m = ", $CellContext`\[Alpha]m, 
          ", \[Beta]1 = ", $CellContext`\[Beta]1$$}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {
      Hold[
       Dynamic[
        Row[{
         "ADAM: \[Alpha] = ", $CellContext`\[Alpha]$$, 
          ", \[Beta]1 = ", $CellContext`\[Beta]1$$, 
          ", \[Beta]2 = ", $CellContext`\[Beta]2$$}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`\[Alpha]$$], 0.5, "\[Alpha]"}, 0, 1}, {{
       Hold[$CellContext`\[Beta]1$$], 0.8, "\[Beta]1"}, 0, 1, 0.01}, {{
       Hold[$CellContext`\[Beta]2$$], 0.9, "\[Beta]2"}, 0, 1, 0.01}, {
      Hold[
       Dynamic[
        Row[{
         "OGR: \[Eta] = ", $CellContext`\[Eta]$$, 
          ", \[Beta] = ", $CellContext`\[Beta]$$, 
          ", \[Gamma] = ", $CellContext`\[Gamma]$$}]]], 
      Manipulate`Dump`ThisIsNotAControl}, {{
       Hold[$CellContext`\[Eta]$$], 0.7, "\[Eta]"}, 0, 1, 0.01}, {{
       Hold[$CellContext`\[Beta]$$], 0.7, "\[Beta]"}, 0, 1, 0.01}, {{
       Hold[$CellContext`\[Gamma]$$], 0.7, "\[Gamma]"}, 0, 1, 0.01}, {{
       Hold[$CellContext`max\[Alpha]$$], 0.1, "max\[Alpha]"}, 0.01, 1}}, 
    Typeset`size$$ = {450., {229., 232.4590824127198}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = False}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`fn$$ = 
        1, $CellContext`l\[Alpha]m$$ = -9, $CellContext`max\[Alpha]$$ = 
        0.1, $CellContext`mode$$ = 
        1, $CellContext`pt$$ = {1, 2}, $CellContext`rn$$ = 
        3, $CellContext`seed$$ = 1, $CellContext`steps$$ = 
        20, $CellContext`\[Alpha]$$ = 0.5, $CellContext`\[Beta]$$ = 
        0.7, $CellContext`\[Beta]1$$ = 0.8, $CellContext`\[Beta]2$$ = 
        0.9, $CellContext`\[Gamma]$$ = 0.7, $CellContext`\[Eta]$$ = 
        0.7, $CellContext`\[Sigma]$$ = 0.5}, "ControllerVariables" :> {}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Module[{}, 
        SeedRandom[$CellContext`seed$$]; $CellContext`rrn = 
         Round[$CellContext`rn$$]; $CellContext`f = 
         Part[$CellContext`fun, $CellContext`fn$$]; $CellContext`g = 
         Part[$CellContext`gr, $CellContext`fn$$]; {$CellContext`ix, \
$CellContext`iy} = $CellContext`pt$$; $CellContext`\[Alpha]m = 
         Exp[$CellContext`l\[Alpha]m$$] + 0.; $CellContext`hst = {}; 
        Switch[$CellContext`mode$$, 1, $CellContext`traj = Table[
             $CellContext`fndtr[$CellContext`ix, $CellContext`iy, \
$CellContext`mt], {$CellContext`mt, $CellContext`mtn}]; Show[
            ContourPlot[
             
             Log[$CellContext`f], {$CellContext`x, -$CellContext`rn$$, \
$CellContext`rn$$}, {$CellContext`y, -$CellContext`rn$$, $CellContext`rn$$}, 
             ImageSize -> 500, PlotLabel -> Row[{$CellContext`steps$$, 
                Style[" steps", Bold], " for methods: ", 
                Row[$CellContext`labn, ","]}]], 
            Graphics[{
              Text[
               Style["x", Red], {0, 0}], Orange, 
              Ball[{$CellContext`ix, $CellContext`iy}, 0.1], 
              Table[{
                Thickness[0.01], 
                Part[$CellContext`col, $CellContext`mt], 
                Line[
                 
                 Part[$CellContext`traj, $CellContext`mt]]}, \
{$CellContext`mt, $CellContext`mtn}]}]], 
          2, $CellContext`traj = 
           Table[$CellContext`tr = $CellContext`fndtr[$CellContext`ix, \
$CellContext`iy, $CellContext`mt]; Transpose[
               Append[
                Transpose[$CellContext`tr], 
                Table[
                 ReplaceAll[$CellContext`f, 
                  $CellContext`sub[$CellContext`t]], {$CellContext`t, \
$CellContext`tr}]]], {$CellContext`mt, $CellContext`mtn}]; Show[
            
            Plot3D[$CellContext`f, {$CellContext`x, -$CellContext`rn$$, \
$CellContext`rn$$}, {$CellContext`y, -$CellContext`rn$$, $CellContext`rn$$}, 
             ImageSize -> 500, PlotLabel -> 
             Row[{$CellContext`steps$$, " steps for methods: ", 
                Grid[{$CellContext`labn}]}]], 
            Graphics3D[{Thick, 
              Line[{{0, 0, 10^6}, {0, 0, 0}}], Orange, 
              Ball[{$CellContext`ix, $CellContext`iy, 
                ReplaceAll[$CellContext`f, 
                 $CellContext`sub[{$CellContext`ix, $CellContext`iy}]]}, 0.1], 
              Table[{
                Thickness[0.01], 
                Part[$CellContext`col, $CellContext`mt], 
                Line[
                 
                 Part[$CellContext`traj, $CellContext`mt]]}, \
{$CellContext`mt, $CellContext`mtn}]}]], 3, $CellContext`eval = Table[
             Sort[
              Flatten[
               
               Table[$CellContext`fndtr[$CellContext`ix, $CellContext`iy, \
$CellContext`mt]; ReplaceAll[$CellContext`f, 
                  $CellContext`sub[$CellContext`\[Theta]]], {$CellContext`ix, \
-$CellContext`rn$$, $CellContext`rn$$, 
                 1}, {$CellContext`iy, -$CellContext`rn$$, $CellContext`rn$$, 
                 1}]]], {$CellContext`mt, $CellContext`mtn}]; \
$CellContext`geo = Exp[
             Map[Mean, 
              Log[$CellContext`eval]]]; Show[{
             
             ListLogPlot[$CellContext`eval, PlotStyle -> $CellContext`col, 
              PlotLabels -> $CellContext`labn, ImageSize -> 500, PlotLabel -> 
              Column[{
                 
                 Row[{"Sorted values from ", 2 $CellContext`rrn + 1, "x", 
                   2 $CellContext`rrn + 1, 
                   " lattice after ", $CellContext`steps$$, " steps"}], 
                 "Their geometric means (plotted thin lines):", 
                 Grid[{$CellContext`labn, $CellContext`geo}, Frame -> All]}, 
                Center]], 
             ListLogPlot[
              Table[{{0, 
                 Part[$CellContext`geo, $CellContext`i]}, {
                 Length[
                  Part[$CellContext`eval, 1]], 
                 
                 Part[$CellContext`geo, $CellContext`i]}}, {$CellContext`i, \
$CellContext`mtn}], Joined -> True, PlotStyle -> 
              Table[{Thin, $CellContext`c}, {$CellContext`c, \
$CellContext`col}]]}]]], 
      "Specifications" :> {{{$CellContext`mode$$, 1, "mode:"}, {
         1 -> "2D", 2 -> "3D", 3 -> "eval"}}, {{$CellContext`pt$$, {1, 2}, 
          "start:"}, {-3, -3}, {3, 3}}, {{$CellContext`steps$$, 20, "steps"}, 
         1, 50, 1, ImageSize -> Small}, 
        Dynamic[
         Row[{
           Part[$CellContext`fname, $CellContext`fn$$], 
           Style[" function", Bold], " in [", -$CellContext`rn$$, 
           ",", $CellContext`rn$$, 
           "\!\(\*SuperscriptBox[\(]\), \(2\)]\) range"}]], \
{{$CellContext`fn$$, 1, "func"}, {1, 2, 3, 4, 
         5}}, {{$CellContext`rn$$, 3, "range"}, 1, 10, 0.1, ImageSize -> 
         Small}, 
        Dynamic[
         Row[{"N(0,", $CellContext`\[Sigma]$$, ") ", 
           Style["noise", Bold], 
           " for seed = ", $CellContext`seed$$}]], {{$CellContext`\[Sigma]$$, 
          0.5, "noise"}, 0.0001, 10, ImageSize -> 
         Small}, {{$CellContext`seed$$, 1, "seed"}, 1, 100, 1, ImageSize -> 
         Small}, Delimiter, 
        Dynamic[
         Row[{
           Style["Hyperparameters", Bold], 
           ", SGD: \[Alpha]m = ", $CellContext`\[Alpha]m}]], {{$CellContext`l\
\[Alpha]m$$, -9, "ln(\[Alpha]m)"}, -12, -6, ImageSize -> Small}, 
        Dynamic[
         Row[{
          "momentum: \[Alpha]m = ", $CellContext`\[Alpha]m, 
           ", \[Beta]1 = ", $CellContext`\[Beta]1$$}]], 
        Dynamic[
         Row[{
          "ADAM: \[Alpha] = ", $CellContext`\[Alpha]$$, 
           ", \[Beta]1 = ", $CellContext`\[Beta]1$$, 
           ", \[Beta]2 = ", $CellContext`\[Beta]2$$}]], {{$CellContext`\
\[Alpha]$$, 0.5, "\[Alpha]"}, 0, 1, ImageSize -> 
         Small}, {{$CellContext`\[Beta]1$$, 0.8, "\[Beta]1"}, 0, 1, 0.01, 
         ImageSize -> Small}, {{$CellContext`\[Beta]2$$, 0.9, "\[Beta]2"}, 0, 
         1, 0.01, ImageSize -> Small}, 
        Dynamic[
         Row[{
          "OGR: \[Eta] = ", $CellContext`\[Eta]$$, 
           ", \[Beta] = ", $CellContext`\[Beta]$$, 
           ", \[Gamma] = ", $CellContext`\[Gamma]$$}]], \
{{$CellContext`\[Eta]$$, 0.7, "\[Eta]"}, 0, 1, 0.01, ImageSize -> 
         Small}, {{$CellContext`\[Beta]$$, 0.7, "\[Beta]"}, 0, 1, 0.01, 
         ImageSize -> Small}, {{$CellContext`\[Gamma]$$, 0.7, "\[Gamma]"}, 0, 
         1, 0.01, ImageSize -> 
         Small}, {{$CellContext`max\[Alpha]$$, 0.1, "max\[Alpha]"}, 0.01, 1, 
         ImageSize -> Small}}, 
      "Options" :> {
       TrackedSymbols :> {$CellContext`steps$$, $CellContext`\[Sigma]$$, \
$CellContext`seed$$, $CellContext`fn$$, $CellContext`mode$$, \
$CellContext`rn$$, $CellContext`\[Alpha]$$, $CellContext`l\[Alpha]m$$, \
$CellContext`\[Beta]1$$, $CellContext`\[Beta]2$$, $CellContext`\[Eta]$$, \
$CellContext`\[Beta]$$, $CellContext`\[Gamma]$$, $CellContext`pt$$, \
$CellContext`max\[Alpha]$$}, ControlPlacement -> Left}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{628., {254.92062988281248`, 260.0793701171875}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    Initialization:>(($CellContext`\[Epsilon] = 
       10^(-6); $CellContext`methods = {
        "SGD", "momentum", "ADAM", "cdOGR", "cfOGR"}; $CellContext`col = {
        Black, Gray, Brown, Green, Blue, Cyan}; $CellContext`mtn = 
       Length[$CellContext`methods]; $CellContext`labn = Table[
         Style[
          Part[$CellContext`methods, $CellContext`i], 
          
          Part[$CellContext`col, $CellContext`i]], {$CellContext`i, \
$CellContext`mtn}]; $CellContext`fname = {
        "Beale", "Rosenbrock", "Matyas", "Goldstein-Price", 
         "Three-hump camel"}; $CellContext`fun = Simplify[{
          
          ReplaceAll[(
             1.5 - $CellContext`x + $CellContext`x $CellContext`y)^2 + (
             2.25 - $CellContext`x + $CellContext`x $CellContext`y^2)^2 + (
             2.625 - $CellContext`x + $CellContext`x $CellContext`y^3)^2, \
{$CellContext`x -> $CellContext`x + 3, $CellContext`y -> $CellContext`y + 
             0.5}], 
          
          ReplaceAll[(1 - $CellContext`x)^2 + 
           100 ($CellContext`y - $CellContext`x^2)^2, {$CellContext`x -> \
$CellContext`x + 1, $CellContext`y -> $CellContext`y + 1}], 
          0.26 ($CellContext`x^2 + $CellContext`y^2) - 
          0.48 $CellContext`x $CellContext`y, 
          
          ReplaceAll[(
             1 + ($CellContext`x + $CellContext`y + 1)^2 (19 - 
               14 $CellContext`x + 3 $CellContext`x^2 - 14 $CellContext`y + 
               6 $CellContext`x $CellContext`y + 3 $CellContext`y^2)) (
             30 + (2 $CellContext`x - 3 $CellContext`y)^2 (18 - 
               32 $CellContext`x + 12 $CellContext`x^2 + 48 $CellContext`y - 
               36 $CellContext`x $CellContext`y + 27 $CellContext`y^2)) - 
           3, $CellContext`y -> $CellContext`y - 1], 2 $CellContext`x^2 - 
          1.05 $CellContext`x^4 + $CellContext`x^6/
           6 + $CellContext`x $CellContext`y + $CellContext`y^2}]; \
$CellContext`gr = Simplify[
         Table[
          
          Grad[$CellContext`f, {$CellContext`x, $CellContext`y}], \
{$CellContext`f, $CellContext`fun}]]; $CellContext`nbf = 
       Length[$CellContext`fun]; $CellContext`v = {$CellContext`x, \
$CellContext`y}; $CellContext`d = Length[$CellContext`v]; $CellContext`s[
         Pattern[$CellContext`M, 
          Blank[]]] := $CellContext`M + 
        Transpose[$CellContext`M]; $CellContext`sub[
         Pattern[$CellContext`p, 
          Blank[]]] := 
       Table[Part[$CellContext`v, $CellContext`i] -> 
         Part[$CellContext`p, $CellContext`i], {$CellContext`i, \
$CellContext`d}]; $CellContext`maxd = 20; $CellContext`noise := RandomReal[
         NormalDistribution[
         0, $CellContext`\[Sigma]$$], $CellContext`d]; $CellContext`fndtr[
         Pattern[$CellContext`ix$, 
          Blank[]], 
         Pattern[$CellContext`iy$, 
          Blank[]], 
         Pattern[$CellContext`mt$, 
          
          Blank[]]] := ($CellContext`\[Theta] = {$CellContext`ix$, \
$CellContext`iy$}; $CellContext`t = ($CellContext`m = ($CellContext`mg = \
($CellContext`m\[Theta] = ($CellContext`vv = ($CellContext`mg\[Theta] = 
              0.))))); $CellContext`dgg = ($CellContext`d\[Theta]\[Theta] = \
$CellContext`\[Epsilon]); $CellContext`m\[Theta]\[Theta] = ($CellContext`mgg = \
$CellContext`\[Epsilon] IdentityMatrix[$CellContext`d]); Prepend[
          
          Table[$CellContext`p\[Theta] = $CellContext`\[Theta]; 
           Part[{$CellContext`SGD, $CellContext`momentum, $CellContext`ADAM, \
$CellContext`cdOGR, $CellContext`cfOGR}, $CellContext`mt$][
            ReplaceAll[$CellContext`g, 
               $CellContext`sub[$CellContext`\[Theta]]] + $CellContext`noise]; 
           If[Norm[$CellContext`\[Theta]] > $CellContext`maxd, $CellContext`\
\[Theta] = $CellContext`p\[Theta]]; $CellContext`\[Theta], {$CellContext`i, \
$CellContext`steps$$}], {$CellContext`ix$, $CellContext`iy$}]); \
$CellContext`SGD[
         Pattern[$CellContext`ng, 
          Blank[]]] := 
       SubtractFrom[$CellContext`\[Theta], $CellContext`\[Alpha]m \
$CellContext`ng]; $CellContext`momentum[
         Pattern[$CellContext`ng$, 
          Blank[]]] := (
        AddTo[$CellContext`m, $CellContext`\[Beta]1$$ ($CellContext`ng$ - \
$CellContext`m)]; 
        SubtractFrom[$CellContext`\[Theta], $CellContext`\[Alpha]m \
$CellContext`ng$]); $CellContext`ADAM[
         Pattern[$CellContext`ng$, 
          Blank[]]] := (
        Increment[$CellContext`t]; $CellContext`m = $CellContext`\[Beta]1$$ \
$CellContext`m + (
            1 - $CellContext`\[Beta]1$$) $CellContext`ng$; $CellContext`vv = \
$CellContext`\[Beta]2$$ $CellContext`vv + (
            1 - $CellContext`\[Beta]2$$) $CellContext`ng$^2; 
        SubtractFrom[$CellContext`\[Theta], $CellContext`\[Alpha]$$ \
($CellContext`m/(($CellContext`\[Epsilon] + 
            Sqrt[$CellContext`vv/(
              1 - $CellContext`\[Beta]2$$^$CellContext`t)]) (
            1 - $CellContext`\[Beta]1$$^$CellContext`t)))]); \
$CellContext`cdOGR[
         Pattern[$CellContext`ng$, 
          Blank[]]] := (
        AddTo[$CellContext`m\[Theta], $CellContext`\[Beta]$$ ($CellContext`\
\[Theta] - $CellContext`m\[Theta])]; 
        AddTo[$CellContext`mg, $CellContext`\[Beta]$$ ($CellContext`ng$ - \
$CellContext`mg)]; 
        AddTo[$CellContext`m, $CellContext`\[Gamma]$$ ($CellContext`ng$ - \
$CellContext`m)]; 
        AddTo[$CellContext`d\[Theta]\[Theta], $CellContext`\[Beta]$$ \
(($CellContext`\[Theta] - $CellContext`m\[Theta])^2 - $CellContext`d\[Theta]\
\[Theta])]; 
        AddTo[$CellContext`dgg, $CellContext`\[Beta]$$ (($CellContext`ng$ - \
$CellContext`mg)^2 - $CellContext`dgg)]; 
        SubtractFrom[$CellContext`\[Theta], $CellContext`\[Eta]$$ \
$CellContext`m 
          Sqrt[$CellContext`d\[Theta]\[Theta]/($CellContext`dgg + \
$CellContext`\[Epsilon])]]); $CellContext`cfOGR[
         Pattern[$CellContext`ng$, 
          Blank[]]] := (
        AddTo[$CellContext`m, $CellContext`\[Gamma]$$ ($CellContext`ng$ - \
$CellContext`m)]; 
        AddTo[$CellContext`m\[Theta], $CellContext`\[Beta]$$ ($CellContext`\
\[Theta] - $CellContext`m\[Theta])]; 
        AddTo[$CellContext`m\[Theta]\[Theta], $CellContext`\[Beta]$$ (
           KroneckerProduct[$CellContext`\[Theta] - $CellContext`m\[Theta], \
$CellContext`\[Theta] - $CellContext`m\[Theta]] - $CellContext`m\[Theta]\
\[Theta])]; 
        AddTo[$CellContext`mg, $CellContext`\[Beta]$$ ($CellContext`ng$ - \
$CellContext`mg)]; 
        AddTo[$CellContext`mgg, $CellContext`\[Beta]$$ (
           KroneckerProduct[$CellContext`ng$ - $CellContext`mg, \
$CellContext`ng$ - $CellContext`mg] - $CellContext`mgg)]; $CellContext`\
\[Sigma]\[Theta] = 
         MatrixFunction[
          Sqrt, $CellContext`m\[Theta]\[Theta]]; $CellContext`\[Sigma]g = 
         MatrixFunction[
          Sqrt, $CellContext`mgg]; {$CellContext`e, $CellContext`ev} = 
         Eigensystem[$CellContext`m\[Theta]\[Theta]]; $CellContext`pH = Dot[
           Transpose[$CellContext`ev], Dot[$CellContext`ev, 
             $CellContext`s[
              Dot[$CellContext`\[Sigma]\[Theta], $CellContext`\[Sigma]g]], 
             Transpose[$CellContext`ev]]/$CellContext`s[
            Table[$CellContext`e, $CellContext`d]], $CellContext`ev]; 
        SubtractFrom[$CellContext`\[Theta], $CellContext`\[Eta]$$ Dot[
            MatrixFunction[
            Min[1/#, $CellContext`max\[Alpha]$$]& , $CellContext`pH], \
$CellContext`m]]); Null); Typeset`initDone$$ = True),
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.8871815269737425`*^9, {3.8871816204811907`*^9, 3.887181641377767*^9}, 
   3.887267335361438*^9},
 CellLabel->
  "Out[114]=",ExpressionUUID->"a5d50089-05c0-4593-9857-abeb97d9e8c5"]
}, Open  ]]
},
WindowSize->{1142.1, 648.9},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>0.9 Inherited,
FrontEndVersion->"13.2 for Microsoft Windows (64-bit) (November 18, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"1ebb4ecb-a486-4109-90df-5cf90802dd92"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1211, 34, 60, "Input",ExpressionUUID->"d26b43b1-6258-4aac-a226-e3f633118636"],
Cell[CellGroupData[{
Cell[1794, 58, 37714, 954, 1198, "Input",ExpressionUUID->"9995ae96-4f48-40b5-aeca-d4b381962e76",
 CellID->237946211],
Cell[39511, 1014, 19395, 392, 532, "Output",ExpressionUUID->"a5d50089-05c0-4593-9857-abeb97d9e8c5"]
}, Open  ]]
}
]
*)

